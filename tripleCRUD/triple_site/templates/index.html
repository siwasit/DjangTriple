{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TripleCheck</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="{% static 'mfunc.js' %}"></script>
    <script>
        // Track approval status of each item
        var approvalStatus = {};
        var itemsAmount = '{{ items|length }}';
        for (var i = 1; i < itemsAmount; i++) {
            approvalStatus[i] = false; // Assuming item IDs start from 0
        }

        function toggleApproval(itemId) {
            approvalStatus[itemId] = !approvalStatus[itemId];
            updateButtonColor(itemId);
            checkAllApproved();
        }

        function checkAllApproved() {
            var allApproved = true;
            for (var key in approvalStatus) {
                if (!approvalStatus[key]) {
                    allApproved = false;
                    break;
                }
            }
            document.getElementById('exportBtn').disabled = !allApproved;
        }

        function updateButtonColor(itemId) {
            var button = document.getElementById('approvalBtn' + itemId);
            if (approvalStatus[itemId]) {
                button.classList.remove('btn-warning');
                button.classList.add('btn-success');
            } else {
                button.classList.remove('btn-success');
                button.classList.add('btn-warning');
            }
        }
    </script>
</head>

<body>
    <div class="container">
        <h2>Triple Table Dashboard</h2>
        <div style="height: 30rem; overflow-y: auto;">
            <table class="table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th></th>
                        <th>Subject</th>
                        <th>Predicate</th>
                        <th>Object</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in items %}
                    <tr>
                        <td>{{ item.0 }}</td>
                        <td class="">
                            <button class="btn btn-primary btn-margin"
                                onclick="showEditForm('{{ item.0 }}', '{{ item.1 }}', '{{ item.2 }}', '{{ item.3 }}')">Edit</button>
                            <button class="btn btn-danger btn-margin"
                                onclick="delete_triple('{{ item.0 }}')">Delete</button>
                        </td>
                        <td>{{ item.1 }}</td>
                        <td>{{ item.2 }}</td>
                        <td>{{ item.3 }}</td>
                        <td>
                            <button id="approvalBtn{{ item.0 }}" class="btn btn-warning btn-margin" onclick="toggleApproval('{{ item.0 }}')">
                                Approve
                            </button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div id="editFormContainer" style="display: none;">
            <hr>
            <form id="editForm" method="POST" action="" class="mt-3">
                {% csrf_token %}
                <input type="hidden" id="editTripleId" name="editTripleId">
                <div class="form-group">
                    <label for="editSubject">Subject:</label>
                    <input type="text" class="form-control" id="editSubject" name="editSubject">
                </div>
                <div class="form-group">
                    <label for="editPredicate">Predicate:</label>
                    <input type="text" class="form-control" id="editPredicate" name="editPredicate">
                </div>
                <div class="form-group">
                    <label for="editObject">Object:</label>
                    <input type="text" class="form-control" id="editObject" name="editObject">
                </div>
                <button type="submit" class="btn btn-primary">Update Triple</button>
                <button type="button" class="btn btn-secondary" onclick="cancelEdit()">Cancel</button>
            </form>
            <hr>
        </div>

        <form method="POST" class="mt-3 ">
            {% csrf_token %}
            <div class="form-row">
                <div class="col">
                    <div class="form-group">
                        <label for="{{ add_form.subject.id_for_label }}">Subject:</label>
                        {{ add_form.subject }}
                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <label for="{{ add_form.predicate.id_for_label }}">Predicate:</label>
                        {{ add_form.predicate }}
                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <label for="{{ add_form.object.id_for_label }}">Object:</label>
                        {{ add_form.object }}
                    </div>
                </div>
                <div class="col">
                    <input type="hidden" name="add_form_submit" value="1">
                    <button type="submit" class="btn btn-primary">Add More Triple</button>
                </div>
            </div>
        </form>

        <button class="btn btn-primary" onclick="logout()">Logout</button>
        <button id="exportBtn" class="btn btn-primary" onclick="export_graph()" disabled>Export</button>
    </div>
</body>

</html>